# План реализации: Приемка товара (MVP)

Этот документ описывает полный путь разработки функционала приемки товара до состояния MVP (Minimum Viable Product).

## Фаза 1: Подготовка и Загрузка [Выполнено]

Цель: Дать возможность загрузить накладную и подготовить данные для приемки.

1.  **Страница списка (`/receiving`)**:
    *   Таблица/Список активных сессий.
    *   Статусы: Черновик, В работе, Завершено.
2.  **Мастер создания (`/receiving/new`)**:
    *   **Загрузка**: Поддержка Excel, JSON, CSV. Парсинг данных на клиенте.
    *   **Маппинг**: Интерфейс для связывания "Строка накладной" -> "Товар каталога".
    *   *Результат*: Создается объект `ReceivingSession`, сохраненный локально или на сервере.

## Фаза 2: Интерфейс ТСД (Основная работа)

Цель: Создать удобный UI для работы на маленьком экране терминала с аппаратным сканером.

1.  **Dashboard Сессии (`/receiving/[id]`)**:
    *   **UI**: Сетка крупных карточек (Grid layout).
    *   **Индикация**:
        *   Зеленый: Группа собрана полностью (10/10).
        *   Желтый: В процессе (5/10).
        *   Серый: Не начато (0/10).
        *   Красный: Перебор (11/10).
    *   **Навигация**: Клик по карточке -> Переход в экран сканирования.

2.  **Экран Сканирования (Active Scan Mode)**:
    *   **Фокус**: Это "модальный" режим. Все внимание на ввод данных для *конкретной* группы товаров.
    *   **Методы ввода**:
        *   **Скан (Hardware)**: Перехват событий клавиатуры (HID-режим сканера). Автоматическое добавление +1.
        *   **Коробка (Box Mode)**: Toggle-переключатель. Скан -> Диалог "Введите кол-во" -> Добавление +N.
        *   **Ручной ввод (Manual)**: Кнопка "Ввести кол-во вручную" -> Input type number.
    *   **История**: Список последних 5 сканов с возможностью отмены (удаления).

## Фаза 3: Управление данными и API

Цель: Обеспечить сохранение прогресса и финальное проведение документов.

1.  **Локальный Стор (`ReceivingService`)**:
    *   Для MVP используем `localStorage` или Context для хранения сессий "на лету". Это позволит тестировать интерфейс без готового бэкенда.
    *   Структура обновления: `updateSessionItem(sessionId, itemId, deltaQuantity)`.

2.  **Интеграция с API (Финал)**:
    *   `POST /api/receiving` - Создать черновик.
    *   `PUT /api/receiving/:id` - Сохранить прогресс (периодически).
    *   `POST /api/receiving/:id/commit` - Завершить приемку. Создает реальные `StockMovements` и обновляет остатки.

## Фаза 4: Логика Сканера и UX

Цель: "Battle-testing" логики ввода.

1.  **Хук `useScanDetection`**:
    *   Определяет ввод со сканера (обычно это быстрый ввод символов + Enter).
    *   Отличает скан от ручного ввода на клавиатуре.
2.  **Звуковая индикация**:
    *   Успех (Beep).
    *   Ошибка/Дубль/Перебор (Error Buzz). (Опционально для MVP).

## План работ (To-Do)

- [ ] Верстка Dashboard (`/receiving/[id]`).
- [ ] Верстка Экрана Сканирования.
- [ ] Реализация хука сканера.
- [ ] Связка всего процесса в единый флоу.
- [ ] Тестирование сценариев (Коробки, Ошибки, Отмена).

